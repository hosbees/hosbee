<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비밀번호 찾기 - HOSBEE</title>
    <link rel="stylesheet" href="../css/common.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #ffeb3b 0%, #ff9800 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .reset-container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 100%;
            max-width: 450px;
            margin: 20px;
        }

        .reset-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .reset-header h1 {
            color: #333;
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .reset-header p {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .step {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
        }

        .step-number.active {
            background: #ff9800;
            color: white;
        }

        .step-number.completed {
            background: #28a745;
            color: white;
        }

        .step-line {
            width: 40px;
            height: 2px;
            background: #e9ecef;
            margin: 0 10px;
        }

        .step-line.completed {
            background: #28a745;
        }

        .reset-step {
            display: none;
        }

        .reset-step.active {
            display: block;
        }

        .form-input {
            height: 50px;
            font-size: 16px;
        }

        .form-input.error {
            border-color: #dc3545;
            box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
        }

        .form-input.success {
            border-color: #28a745;
            box-shadow: 0 0 0 3px rgba(40, 167, 69, 0.1);
        }

        .verification-input {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .verification-input input {
            width: 50px;
            height: 50px;
            text-align: center;
            font-size: 20px;
            font-weight: 600;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .verification-input input:focus {
            border-color: #ff9800;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .resend-timer {
            text-align: center;
            margin: 15px 0;
            color: #666;
            font-size: 14px;
        }

        .resend-timer.expired {
            color: #dc3545;
        }

        .resend-btn {
            background: none;
            border: none;
            color: #ff9800;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
        }

        .resend-btn:disabled {
            color: #ccc;
            cursor: not-allowed;
            text-decoration: none;
        }

        .password-requirements {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .password-requirements h4 {
            color: #333;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .requirement-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            color: #666;
            margin: 5px 0;
        }

        .requirement-item.valid {
            color: #28a745;
        }

        .requirement-icon {
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .requirement-icon.valid {
            background: #28a745;
            color: white;
        }

        .action-btn {
            width: 100%;
            height: 50px;
            font-size: 16px;
            font-weight: 600;
            margin: 20px 0 10px 0;
            background: #ff9800 !important;
            border: none !important;
            color: white !important;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .action-btn:hover {
            background: #f57c00 !important;
        }

        .action-btn:disabled {
            background: #ccc !important;
            cursor: not-allowed;
        }

        .back-btn {
            width: 100%;
            height: 45px;
            background: #f8f9fa;
            color: #666;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background: #e9ecef;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: #28a745;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px auto;
            color: white;
            font-size: 40px;
        }

        .success-message {
            text-align: center;
            margin-bottom: 30px;
        }

        .success-message h3 {
            color: #333;
            font-size: 24px;
            margin-bottom: 10px;
        }

        .success-message p {
            color: #666;
            font-size: 14px;
        }

        .error-message {
            color: #dc3545;
            font-size: 12px;
            margin-top: 5px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .reset-container {
                padding: 30px 20px;
            }

            .verification-input input {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div class="reset-container">
        <div class="reset-header">
            <h1>비밀번호 찾기</h1>
            <p>등록된 이메일로 인증을 통해<br>새로운 비밀번호를 설정하세요</p>
        </div>

        <div class="step-indicator">
            <div class="step">
                <div class="step-number active" id="step1-indicator">1</div>
                <div class="step-line" id="line1"></div>
                <div class="step-number" id="step2-indicator">2</div>
                <div class="step-line" id="line2"></div>
                <div class="step-number" id="step3-indicator">3</div>
            </div>
        </div>

        <!-- Step 1: Email Input -->
        <div class="reset-step active" id="step1">
            <form id="emailForm">
                <div class="form-group">
                    <label class="form-label" for="email">이메일 주소</label>
                    <input type="email" id="email" name="email" class="form-input" placeholder="가입시 사용한 이메일을 입력하세요" required>
                    <div class="error-message" id="emailError"></div>
                </div>

                <button type="submit" class="btn btn-primary action-btn">인증번호 발송</button>
                <button type="button" class="back-btn" onclick="goToLogin()">로그인으로 돌아가기</button>
            </form>
        </div>

        <!-- Step 2: Verification Code -->
        <div class="reset-step" id="step2">
            <div class="form-group">
                <label class="form-label">인증번호 입력</label>
                <p style="text-align: center; color: #666; font-size: 14px; margin-bottom: 20px;">
                    <span id="emailDisplay"></span>로<br>발송된 6자리 인증번호를 입력하세요
                </p>

                <div class="verification-input">
                    <input type="text" maxlength="1" class="verify-digit" data-index="0">
                    <input type="text" maxlength="1" class="verify-digit" data-index="1">
                    <input type="text" maxlength="1" class="verify-digit" data-index="2">
                    <input type="text" maxlength="1" class="verify-digit" data-index="3">
                    <input type="text" maxlength="1" class="verify-digit" data-index="4">
                    <input type="text" maxlength="1" class="verify-digit" data-index="5">
                </div>

                <div class="resend-timer" id="timer">
                    남은 시간: <span id="countdown">03:00</span>
                </div>

                <div style="text-align: center;">
                    <button class="resend-btn" id="resendBtn" disabled>인증번호 재발송</button>
                </div>

                <div class="error-message" id="verificationError"></div>
            </div>

            <button type="button" class="btn btn-primary action-btn" id="verifyBtn" disabled>확인</button>
            <button type="button" class="back-btn" onclick="goToStep(1)">이전 단계</button>
        </div>

        <!-- Step 3: New Password -->
        <div class="reset-step" id="step3">
            <form id="passwordForm">
                <div class="form-group">
                    <label class="form-label" for="newPassword">새 비밀번호</label>
                    <input type="password" id="newPassword" name="newPassword" class="form-input" placeholder="새 비밀번호를 입력하세요" required>
                </div>

                <div class="form-group">
                    <label class="form-label" for="confirmPassword">비밀번호 확인</label>
                    <input type="password" id="confirmPassword" name="confirmPassword" class="form-input" placeholder="비밀번호를 다시 입력하세요" required>
                </div>

                <div class="password-requirements">
                    <h4>비밀번호 요구사항</h4>
                    <div class="requirement-item" id="req-length">
                        <div class="requirement-icon">×</div>
                        8자 이상
                    </div>
                    <div class="requirement-item" id="req-letter">
                        <div class="requirement-icon">×</div>
                        영문 포함
                    </div>
                    <div class="requirement-item" id="req-number">
                        <div class="requirement-icon">×</div>
                        숫자 포함
                    </div>
                    <div class="requirement-item" id="req-special">
                        <div class="requirement-icon">×</div>
                        특수문자 포함
                    </div>
                    <div class="requirement-item" id="req-match">
                        <div class="requirement-icon">×</div>
                        비밀번호 일치
                    </div>
                </div>

                <div class="error-message" id="passwordError"></div>

                <button type="submit" class="btn btn-primary action-btn" id="resetBtn" disabled>비밀번호 변경</button>
                <button type="button" class="back-btn" onclick="goToStep(2)">이전 단계</button>
            </form>
        </div>

        <!-- Step 4: Success -->
        <div class="reset-step" id="step4">
            <div class="success-icon">✓</div>
            <div class="success-message">
                <h3>비밀번호 변경 완료</h3>
                <p>새로운 비밀번호로 로그인하세요</p>
            </div>
            <button type="button" class="btn btn-primary action-btn" onclick="goToLogin()">로그인하기</button>
        </div>
    </div>

    <script>
        let currentStep = 1;
        let verificationTimer;
        let countdownTime = 180; // 3분
        let userEmail = '';

        // Step 1: Email verification
        document.getElementById('emailForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const email = document.getElementById('email').value;
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!emailRegex.test(email)) {
                showError('emailError', '올바른 이메일 형식을 입력해주세요.');
                return;
            }

            userEmail = email;

            // 인증번호 발송 시뮬레이션
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<div class="spinner"></div>';
            submitBtn.disabled = true;

            setTimeout(() => {
                goToStep(2);
                startTimer();
                document.getElementById('emailDisplay').textContent = email;
            }, 1500);
        });

        // Step 2: Verification code handling
        const verifyDigits = document.querySelectorAll('.verify-digit');

        verifyDigits.forEach((input, index) => {
            input.addEventListener('input', function(e) {
                const value = e.target.value;

                // Only allow numbers
                if (!/^\d$/.test(value)) {
                    e.target.value = '';
                    return;
                }

                // Move to next input
                if (value && index < verifyDigits.length - 1) {
                    verifyDigits[index + 1].focus();
                }

                checkVerificationCode();
            });

            input.addEventListener('keydown', function(e) {
                // Move to previous input on backspace
                if (e.key === 'Backspace' && !e.target.value && index > 0) {
                    verifyDigits[index - 1].focus();
                }
            });

            input.addEventListener('paste', function(e) {
                e.preventDefault();
                const paste = e.clipboardData.getData('text');
                const digits = paste.replace(/\D/g, '').slice(0, 6);

                digits.split('').forEach((digit, i) => {
                    if (verifyDigits[i]) {
                        verifyDigits[i].value = digit;
                    }
                });

                checkVerificationCode();
            });
        });

        document.getElementById('verifyBtn').addEventListener('click', function() {
            const code = Array.from(verifyDigits).map(input => input.value).join('');

            // 임시 인증번호: 123456
            if (code === '123456') {
                clearInterval(verificationTimer);
                goToStep(3);
            } else {
                showError('verificationError', '잘못된 인증번호입니다.');
                verifyDigits.forEach(input => {
                    input.style.borderColor = '#dc3545';
                });
            }
        });

        // Step 3: Password reset
        const newPasswordInput = document.getElementById('newPassword');
        const confirmPasswordInput = document.getElementById('confirmPassword');

        newPasswordInput.addEventListener('input', validatePassword);
        confirmPasswordInput.addEventListener('input', validatePassword);

        document.getElementById('passwordForm').addEventListener('submit', function(e) {
            e.preventDefault();

            if (!isPasswordValid()) {
                return;
            }

            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.innerHTML = '<div class="spinner"></div>';
            submitBtn.disabled = true;

            // 비밀번호 변경 시뮬레이션
            setTimeout(() => {
                goToStep(4);
            }, 2000);
        });

        // Resend code
        document.getElementById('resendBtn').addEventListener('click', function() {
            if (this.disabled) return;

            // 재발송 시뮬레이션
            this.disabled = true;
            countdownTime = 180;
            startTimer();

            // Clear previous verification
            verifyDigits.forEach(input => {
                input.value = '';
                input.style.borderColor = '#e9ecef';
            });
            hideError('verificationError');

            alert('인증번호가 재발송되었습니다.');
        });

        // Utility functions
        function goToStep(step) {
            // Hide all steps
            document.querySelectorAll('.reset-step').forEach(s => s.classList.remove('active'));

            // Show target step
            document.getElementById(`step${step}`).classList.add('active');

            // Update step indicators
            updateStepIndicators(step);
            currentStep = step;
        }

        function updateStepIndicators(activeStep) {
            for (let i = 1; i <= 3; i++) {
                const indicator = document.getElementById(`step${i}-indicator`);
                const line = document.getElementById(`line${i}`);

                if (i < activeStep) {
                    indicator.classList.add('completed');
                    indicator.classList.remove('active');
                    indicator.textContent = '✓';
                    if (line) line.classList.add('completed');
                } else if (i === activeStep) {
                    indicator.classList.add('active');
                    indicator.classList.remove('completed');
                    indicator.textContent = i;
                } else {
                    indicator.classList.remove('active', 'completed');
                    indicator.textContent = i;
                    if (line) line.classList.remove('completed');
                }
            }
        }

        function startTimer() {
            const timerElement = document.getElementById('timer');
            const countdownElement = document.getElementById('countdown');
            const resendBtn = document.getElementById('resendBtn');

            resendBtn.disabled = true;
            timerElement.classList.remove('expired');

            verificationTimer = setInterval(() => {
                const minutes = Math.floor(countdownTime / 60);
                const seconds = countdownTime % 60;
                countdownElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;

                if (countdownTime <= 0) {
                    clearInterval(verificationTimer);
                    timerElement.classList.add('expired');
                    timerElement.innerHTML = '인증시간이 만료되었습니다. <button class="resend-btn" onclick="document.getElementById(\'resendBtn\').click()">재발송</button>';
                    resendBtn.disabled = false;
                }

                countdownTime--;
            }, 1000);
        }

        function checkVerificationCode() {
            const code = Array.from(verifyDigits).map(input => input.value).join('');
            const verifyBtn = document.getElementById('verifyBtn');

            verifyBtn.disabled = code.length !== 6;

            if (code.length === 6) {
                verifyDigits.forEach(input => {
                    input.style.borderColor = '#ff9800';
                });
            }
        }

        function validatePassword() {
            const password = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            // Check requirements
            const requirements = {
                'req-length': password.length >= 8,
                'req-letter': /[a-zA-Z]/.test(password),
                'req-number': /\d/.test(password),
                'req-special': /[!@#$%^&*]/.test(password),
                'req-match': confirmPassword && password === confirmPassword
            };

            Object.entries(requirements).forEach(([id, valid]) => {
                const element = document.getElementById(id);
                const icon = element.querySelector('.requirement-icon');

                if (valid) {
                    element.classList.add('valid');
                    icon.textContent = '✓';
                    icon.classList.add('valid');
                } else {
                    element.classList.remove('valid');
                    icon.textContent = '×';
                    icon.classList.remove('valid');
                }
            });

            // Update input styles
            if (password) {
                const isPasswordValid = requirements['req-length'] && requirements['req-letter'] &&
                                      requirements['req-number'] && requirements['req-special'];
                newPasswordInput.className = `form-input ${isPasswordValid ? 'success' : 'error'}`;
            }

            if (confirmPassword) {
                confirmPasswordInput.className = `form-input ${requirements['req-match'] ? 'success' : 'error'}`;
            }

            // Enable/disable submit button
            document.getElementById('resetBtn').disabled = !isPasswordValid();
        }

        function isPasswordValid() {
            const password = newPasswordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            return password.length >= 8 &&
                   /[a-zA-Z]/.test(password) &&
                   /\d/.test(password) &&
                   /[!@#$%^&*]/.test(password) &&
                   password === confirmPassword;
        }

        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        function hideError(elementId) {
            const errorElement = document.getElementById(elementId);
            errorElement.style.display = 'none';
        }

        function goToLogin() {
            window.location.href = 'login.html';
        }
    </script>
</body>
</html>